CPP = g++
CFLAGS = -Wall -O3 -pipe
RM = del
PATH_SEPARATOR = \\

INCLUDE = C:$(PATH_SEPARATOR)Strawberry$(PATH_SEPARATOR)perl$(PATH_SEPARATOR)lib$(PATH_SEPARATOR)CORE

XSTOOLS_DIR = src$(PATH_SEPARATOR)auto$(PATH_SEPARATOR)XSTools
PATHFINDING_DIR = $(XSTOOLS_DIR)$(PATH_SEPARATOR)PathFinding
TRANSLATION_DIR = $(XSTOOLS_DIR)$(PATH_SEPARATOR)Translation
WIN32_DIR = $(XSTOOLS_DIR)$(PATH_SEPARATOR)win32
UTILS_DIR = $(XSTOOLS_DIR)$(PATH_SEPARATOR)utils
UTILS_CBINDINGS_DIR = $(UTILS_DIR)$(PATH_SEPARATOR)c-bindings
UTILS_PERL_DIR = $(UTILS_DIR)$(PATH_SEPARATOR)perl
PADDEDPACKETS_DIR = $(XSTOOLS_DIR)$(PATH_SEPARATOR)PaddedPackets
PADDEDPACKETS_ALGORITHMS_DIR = $(PADDEDPACKETS_DIR)$(PATH_SEPARATOR)Algorithms
MISC_DIR = $(XSTOOLS_DIR)$(PATH_SEPARATOR)misc

TYPEMAP = PathFinding$(PATH_SEPARATOR)typemap

ALL_OS = $(PATHFINDING_DIR)$(PATH_SEPARATOR)algorithm.os $(PATHFINDING_DIR)$(PATH_SEPARATOR)PathFinding.xs.os $(TRANSLATION_DIR)$(PATH_SEPARATOR)filereader.os
ALL_OS += $(TRANSLATION_DIR)$(PATH_SEPARATOR)translator.os $(TRANSLATION_DIR)$(PATH_SEPARATOR)utils.os $(TRANSLATION_DIR)$(PATH_SEPARATOR)Translation.xs.os
ALL_OS += $(TRANSLATION_DIR)$(PATH_SEPARATOR)winfilereader.os $(WIN32_DIR)$(PATH_SEPARATOR)utils.os $(WIN32_DIR)$(PATH_SEPARATOR)wrapper.os
ALL_OS += $(UTILS_DIR)$(PATH_SEPARATOR)http-reader.os $(UTILS_DIR)$(PATH_SEPARATOR)std-http-reader.os $(UTILS_DIR)$(PATH_SEPARATOR)mirror-http-reader.os
ALL_OS += $(UTILS_DIR)$(PATH_SEPARATOR)whirlpool-algorithm.os $(UTILS_DIR)$(PATH_SEPARATOR)Rijndael.os $(UTILS_DIR)$(PATH_SEPARATOR)rijndael-api-fst.os
ALL_OS += $(UTILS_DIR)$(PATH_SEPARATOR)rijndael-alg-fst.os $(UTILS_CBINDINGS_DIR)$(PATH_SEPARATOR)http-reader.os
ALL_OS += $(UTILS_DIR)$(PATH_SEPARATOR)aes-cfb.os $(UTILS_PERL_DIR)$(PATH_SEPARATOR)HttpReader.os
ALL_OS += $(UTILS_PERL_DIR)$(PATH_SEPARATOR)Whirlpool.os $(UTILS_PERL_DIR)$(PATH_SEPARATOR)Rijndael.xs.os
ALL_OS += $(UTILS_PERL_DIR)$(PATH_SEPARATOR)Benchmark.os $(PADDEDPACKETS_ALGORITHMS_DIR)$(PATH_SEPARATOR)cast.os
ALL_OS += $(PADDEDPACKETS_ALGORITHMS_DIR)$(PATH_SEPARATOR)feal8.os $(PADDEDPACKETS_ALGORITHMS_DIR)$(PATH_SEPARATOR)mcg_cipher.os
ALL_OS += $(PADDEDPACKETS_ALGORITHMS_DIR)$(PATH_SEPARATOR)misty1.os $(PADDEDPACKETS_ALGORITHMS_DIR)$(PATH_SEPARATOR)rmd128.os
ALL_OS += $(PADDEDPACKETS_ALGORITHMS_DIR)$(PATH_SEPARATOR)safer.os $(PADDEDPACKETS_ALGORITHMS_DIR)$(PATH_SEPARATOR)seal.os
ALL_OS += $(PADDEDPACKETS_ALGORITHMS_DIR)$(PATH_SEPARATOR)snefru.os $(PADDEDPACKETS_ALGORITHMS_DIR)$(PATH_SEPARATOR)tiger.os
ALL_OS += $(PADDEDPACKETS_ALGORITHMS_DIR)$(PATH_SEPARATOR)turtle.os $(PADDEDPACKETS_ALGORITHMS_DIR)$(PATH_SEPARATOR)algorithms.os
ALL_OS += $(PADDEDPACKETS_DIR)$(PATH_SEPARATOR)block.os $(PADDEDPACKETS_DIR)$(PATH_SEPARATOR)engine.os $(PADDEDPACKETS_DIR)$(PATH_SEPARATOR)PaddedPackets.xs.os
ALL_OS += $(MISC_DIR)$(PATH_SEPARATOR)misc.os $(MISC_DIR)$(PATH_SEPARATOR)fastutils.os

ALL_CPP_FROM_XS = $(PATHFINDING_DIR)$(PATH_SEPARATOR)PathFinding.xs.cpp $(TRANSLATION_DIR)$(PATH_SEPARATOR)Translation.xs.cpp
ALL_CPP_FROM_XS += $(WIN32_DIR)$(PATH_SEPARATOR)wrapper.xs.cpp $(UTILS_PERL_DIR)$(PATH_SEPARATOR)HttpReader.xs.cpp
ALL_CPP_FROM_XS += $(UTILS_PERL_DIR)$(PATH_SEPARATOR)Whirlpool.xs.cpp $(UTILS_PERL_DIR)$(PATH_SEPARATOR)Rijndael.xs.cpp
ALL_CPP_FROM_XS += $(UTILS_PERL_DIR)$(PATH_SEPARATOR)Benchmark.xs.cpp $(PADDEDPACKETS_DIR)$(PATH_SEPARATOR)PaddedPackets.xs.cpp
ALL_CPP_FROM_XS += $(MISC_DIR)$(PATH_SEPARATOR)misc.xs.cpp $(MISC_DIR)$(PATH_SEPARATOR)fastutils.xs.cpp

all: PathFinding Translation Win32 Utils PaddedPackets Misc
	g++ -shared -o src$(PATH_SEPARATOR)auto$(PATH_SEPARATOR)XSTools$(PATH_SEPARATOR)XSTools.dll $(ALL_OS) -LC:$(PATH_SEPARATOR)STRAWB~1$(PATH_SEPARATOR)perl$(PATH_SEPARATOR)lib$(PATH_SEPARATOR)CORE -lperl520 -lws2_32 -lwinmm -lwininet -Wl,--out-implib,src$(PATH_SEPARATOR)auto$(PATH_SEPARATOR)XSTools$(PATH_SEPARATOR)libXSTools.a

PathFinding:
	$(CPP) -c -o $(PATHFINDING_DIR)$(PATH_SEPARATOR)algorithm.os $(PATHFINDING_DIR)$(PATH_SEPARATOR)algorithm.cpp $(CFLAGS)
	xsubpp -typemap typemap $(PATHFINDING_DIR)$(PATH_SEPARATOR)PathFinding.xs > $(PATHFINDING_DIR)$(PATH_SEPARATOR)PathFinding.xs.cpp
	$(CPP) -c -o $(PATHFINDING_DIR)$(PATH_SEPARATOR)PathFinding.xs.os $(PATHFINDING_DIR)$(PATH_SEPARATOR)PathFinding.xs.cpp -I$(INCLUDE) $(CFLAGS)

Translation:
	$(CPP) -c -o $(TRANSLATION_DIR)$(PATH_SEPARATOR)filereader.os $(TRANSLATION_DIR)$(PATH_SEPARATOR)filereader.cpp $(CFLAGS)
	$(CPP) -c -o $(TRANSLATION_DIR)$(PATH_SEPARATOR)translator.os $(TRANSLATION_DIR)$(PATH_SEPARATOR)translator.cpp $(CFLAGS)
	$(CPP) -c -o $(TRANSLATION_DIR)$(PATH_SEPARATOR)utils.os $(TRANSLATION_DIR)$(PATH_SEPARATOR)utils.cpp $(CFLAGS)
	xsubpp $(TRANSLATION_DIR)$(PATH_SEPARATOR)Translation.xs > $(TRANSLATION_DIR)$(PATH_SEPARATOR)Translation.xs.cpp
	$(CPP) -c -o $(TRANSLATION_DIR)$(PATH_SEPARATOR)Translation.xs.os $(TRANSLATION_DIR)$(PATH_SEPARATOR)Translation.xs.cpp $(CFLAGS) -I$(INCLUDE) -I$(TRANSLATION_DIR)
	$(CPP) -c -o $(TRANSLATION_DIR)$(PATH_SEPARATOR)winfilereader.os $(TRANSLATION_DIR)$(PATH_SEPARATOR)winfilereader.cpp $(CFLAGS)

Win32:
	$(CPP) -c -o $(WIN32_DIR)$(PATH_SEPARATOR)utils.os $(WIN32_DIR)$(PATH_SEPARATOR)utils.cpp $(CFLAGS)
	xsubpp $(WIN32_DIR)$(PATH_SEPARATOR)wrapper.xs > $(WIN32_DIR)$(PATH_SEPARATOR)wrapper.xs.cpp
	$(CPP) -c -o $(WIN32_DIR)$(PATH_SEPARATOR)wrapper.os $(WIN32_DIR)$(PATH_SEPARATOR)wrapper.xs.cpp $(CFLAGS) -fpermissive -I$(INCLUDE)

Utils:
	$(CPP) -c -o $(UTILS_DIR)$(PATH_SEPARATOR)http-reader.os $(UTILS_DIR)$(PATH_SEPARATOR)http-reader.cpp $(CFLAGS)
	$(CPP) -c -o $(UTILS_DIR)$(PATH_SEPARATOR)std-http-reader.os $(UTILS_DIR)$(PATH_SEPARATOR)std-http-reader.cpp $(CFLAGS)
	$(CPP) -c -o $(UTILS_DIR)$(PATH_SEPARATOR)mirror-http-reader.os $(UTILS_DIR)$(PATH_SEPARATOR)mirror-http-reader.cpp $(CFLAGS)
	$(CPP) -c -o $(UTILS_DIR)$(PATH_SEPARATOR)whirlpool-algorithm.os $(UTILS_DIR)$(PATH_SEPARATOR)whirlpool-algorithm.c $(CFLAGS)
	$(CPP) -c -o $(UTILS_DIR)$(PATH_SEPARATOR)Rijndael.os $(UTILS_DIR)$(PATH_SEPARATOR)Rijndael.cpp $(CFLAGS)
	$(CPP) -c -o $(UTILS_DIR)$(PATH_SEPARATOR)rijndael-api-fst.os $(UTILS_DIR)$(PATH_SEPARATOR)rijndael-api-fst.c $(CFLAGS)
	$(CPP) -c -o $(UTILS_DIR)$(PATH_SEPARATOR)rijndael-alg-fst.os $(UTILS_DIR)$(PATH_SEPARATOR)rijndael-alg-fst.c $(CFLAGS)
	$(CPP) -c -o $(UTILS_DIR)$(PATH_SEPARATOR)aes-cfb.os $(UTILS_DIR)$(PATH_SEPARATOR)aes-cfb.c $(CFLAGS)
	$(CPP) -c -o $(UTILS_CBINDINGS_DIR)$(PATH_SEPARATOR)http-reader.os $(UTILS_CBINDINGS_DIR)$(PATH_SEPARATOR)http-reader.cpp $(CFLAGS)
	xsubpp $(UTILS_PERL_DIR)$(PATH_SEPARATOR)HttpReader.xs > $(UTILS_PERL_DIR)$(PATH_SEPARATOR)HttpReader.xs.cpp
	$(CPP) -c -o $(UTILS_PERL_DIR)$(PATH_SEPARATOR)HttpReader.os $(UTILS_PERL_DIR)$(PATH_SEPARATOR)HttpReader.xs.cpp $(CFLAGS) -I$(INCLUDE)
	xsubpp $(UTILS_PERL_DIR)$(PATH_SEPARATOR)Whirlpool.xs > $(UTILS_PERL_DIR)$(PATH_SEPARATOR)Whirlpool.xs.cpp
	$(CPP) -c -o $(UTILS_PERL_DIR)$(PATH_SEPARATOR)Whirlpool.os $(UTILS_PERL_DIR)$(PATH_SEPARATOR)Whirlpool.xs.cpp $(CFLAGS) -I$(INCLUDE)
	xsubpp $(UTILS_PERL_DIR)$(PATH_SEPARATOR)Rijndael.xs > $(UTILS_PERL_DIR)$(PATH_SEPARATOR)Rijndael.xs.cpp
	$(CPP) -c -o $(UTILS_PERL_DIR)$(PATH_SEPARATOR)Rijndael.xs.os $(UTILS_PERL_DIR)$(PATH_SEPARATOR)Rijndael.xs.cpp $(CFLAGS) -I$(INCLUDE)
	xsubpp $(UTILS_PERL_DIR)$(PATH_SEPARATOR)Benchmark.xs > $(UTILS_PERL_DIR)$(PATH_SEPARATOR)Benchmark.xs.cpp
	$(CPP) -c -o $(UTILS_PERL_DIR)$(PATH_SEPARATOR)Benchmark.os $(UTILS_PERL_DIR)$(PATH_SEPARATOR)Benchmark.xs.cpp $(CFLAGS) -I$(INCLUDE)

PaddedPackets:
	$(CPP) -c -o $(PADDEDPACKETS_ALGORITHMS_DIR)$(PATH_SEPARATOR)cast.os $(PADDEDPACKETS_ALGORITHMS_DIR)$(PATH_SEPARATOR)cast.c $(CFLAGS)
	$(CPP) -c -o $(PADDEDPACKETS_ALGORITHMS_DIR)$(PATH_SEPARATOR)feal8.os $(PADDEDPACKETS_ALGORITHMS_DIR)$(PATH_SEPARATOR)feal8.c $(CFLAGS)
	$(CPP) -c -o $(PADDEDPACKETS_ALGORITHMS_DIR)$(PATH_SEPARATOR)mcg_cipher.os $(PADDEDPACKETS_ALGORITHMS_DIR)$(PATH_SEPARATOR)mcg_cipher.c $(CFLAGS)
	$(CPP) -c -o $(PADDEDPACKETS_ALGORITHMS_DIR)$(PATH_SEPARATOR)misty1.os $(PADDEDPACKETS_ALGORITHMS_DIR)$(PATH_SEPARATOR)misty1.c $(CFLAGS)
	$(CPP) -c -o $(PADDEDPACKETS_ALGORITHMS_DIR)$(PATH_SEPARATOR)rmd128.os $(PADDEDPACKETS_ALGORITHMS_DIR)$(PATH_SEPARATOR)rmd128.c $(CFLAGS)
	$(CPP) -c -o $(PADDEDPACKETS_ALGORITHMS_DIR)$(PATH_SEPARATOR)safer.os $(PADDEDPACKETS_ALGORITHMS_DIR)$(PATH_SEPARATOR)safer.c $(CFLAGS)
	$(CPP) -c -o $(PADDEDPACKETS_ALGORITHMS_DIR)$(PATH_SEPARATOR)seal.os $(PADDEDPACKETS_ALGORITHMS_DIR)$(PATH_SEPARATOR)seal.c $(CFLAGS)
	$(CPP) -c -o $(PADDEDPACKETS_ALGORITHMS_DIR)$(PATH_SEPARATOR)snefru.os $(PADDEDPACKETS_ALGORITHMS_DIR)$(PATH_SEPARATOR)snefru.c $(CFLAGS)
	$(CPP) -c -o $(PADDEDPACKETS_ALGORITHMS_DIR)$(PATH_SEPARATOR)tiger.os $(PADDEDPACKETS_ALGORITHMS_DIR)$(PATH_SEPARATOR)tiger.c $(CFLAGS)
	$(CPP) -c -o $(PADDEDPACKETS_ALGORITHMS_DIR)$(PATH_SEPARATOR)turtle.os $(PADDEDPACKETS_ALGORITHMS_DIR)$(PATH_SEPARATOR)turtle.c $(CFLAGS)
	$(CPP) -c -o $(PADDEDPACKETS_ALGORITHMS_DIR)$(PATH_SEPARATOR)algorithms.os $(PADDEDPACKETS_ALGORITHMS_DIR)$(PATH_SEPARATOR)algorithms.cpp $(CFLAGS)
	$(CPP) -c -o $(PADDEDPACKETS_DIR)$(PATH_SEPARATOR)block.os $(PADDEDPACKETS_DIR)$(PATH_SEPARATOR)block.cpp $(CFLAGS)
	$(CPP) -c -o $(PADDEDPACKETS_DIR)$(PATH_SEPARATOR)engine.os $(PADDEDPACKETS_DIR)$(PATH_SEPARATOR)engine.cpp $(CFLAGS)
	xsubpp $(PADDEDPACKETS_DIR)$(PATH_SEPARATOR)PaddedPackets.xs > $(PADDEDPACKETS_DIR)$(PATH_SEPARATOR)PaddedPackets.xs.cpp
	$(CPP) -c -o $(PADDEDPACKETS_DIR)$(PATH_SEPARATOR)PaddedPackets.xs.os $(PADDEDPACKETS_DIR)$(PATH_SEPARATOR)PaddedPackets.xs.cpp $(CFLAGS) -I$(INCLUDE)

Misc:
	xsubpp $(MISC_DIR)$(PATH_SEPARATOR)misc.xs > $(MISC_DIR)$(PATH_SEPARATOR)misc.xs.cpp
	$(CPP) -c -o $(MISC_DIR)$(PATH_SEPARATOR)misc.os $(MISC_DIR)$(PATH_SEPARATOR)misc.xs.cpp $(CFLAGS) -I$(INCLUDE)
	xsubpp $(MISC_DIR)$(PATH_SEPARATOR)fastutils.xs > $(MISC_DIR)$(PATH_SEPARATOR)fastutils.xs.cpp
	$(CPP) -c -o $(MISC_DIR)$(PATH_SEPARATOR)fastutils.os $(MISC_DIR)$(PATH_SEPARATOR)fastutils.xs.cpp $(CFLAGS) -I$(INCLUDE) -LC:$(PATH_SEPARATOR)STRAWB~1$(PATH_SEPARATOR)perl$(PATH_SEPARATOR)lib$(PATH_SEPARATOR)CORE -lperl526

clean:
	$(RM) $(ALL_OS) $(ALL_CPP_FROM_XS) XSTools.dll $(XSTOOLS_DIR)$(PATH_SEPARATOR)XSTools.dll $(XSTOOLS_DIR)$(PATH_SEPARATOR)libXSTools.a