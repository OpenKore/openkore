{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://ai-mmorpg.local/schemas/decision_response.json",
  "title": "DecisionResponseMessage",
  "description": "AI decision response sent from AI Sidecar to OpenKore",
  "type": "object",
  "required": ["type", "tick"],
  "properties": {
    "type": {
      "type": "string",
      "const": "decision",
      "description": "Message type identifier"
    },
    "tick": {
      "type": "integer",
      "minimum": 0,
      "description": "Server tick number this decision responds to"
    },
    "actions": {
      "type": "array",
      "description": "Ordered list of actions to execute",
      "items": {
        "$ref": "#/definitions/action"
      },
      "default": []
    },
    "fallback_mode": {
      "type": "string",
      "enum": ["cpu", "gpu", "none"],
      "default": "cpu",
      "description": "Compute mode used for decision (cpu=stub/fallback, gpu=ML)"
    },
    "confidence": {
      "type": "number",
      "minimum": 0.0,
      "maximum": 1.0,
      "description": "Confidence score for this decision"
    },
    "processing_time_ms": {
      "type": "number",
      "minimum": 0,
      "description": "Time taken to process this decision in milliseconds"
    },
    "metadata": {
      "type": "object",
      "description": "Optional metadata about the decision",
      "additionalProperties": true
    }
  },
  "definitions": {
    "action": {
      "type": "object",
      "required": ["type", "priority"],
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "move",
            "attack",
            "skill",
            "use_item",
            "sit",
            "stand",
            "pick_item",
            "talk_npc",
            "teleport",
            "flee",
            "idle",
            "wait",
            "emote",
            "say",
            "party_say"
          ],
          "description": "Action type to execute"
        },
        "priority": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100,
          "description": "Action priority (lower = execute first)"
        },
        "x": {
          "type": "integer",
          "minimum": 0,
          "description": "X coordinate for movement/skill targeting"
        },
        "y": {
          "type": "integer",
          "minimum": 0,
          "description": "Y coordinate for movement/skill targeting"
        },
        "target": {
          "type": "integer",
          "description": "Target actor ID"
        },
        "id": {
          "type": "integer",
          "description": "Skill ID or Item ID"
        },
        "level": {
          "type": "integer",
          "minimum": 1,
          "description": "Skill level to use"
        },
        "amount": {
          "type": "integer",
          "minimum": 1,
          "description": "Item amount to use"
        },
        "delay_ms": {
          "type": "integer",
          "minimum": 0,
          "description": "Delay before executing this action"
        },
        "text": {
          "type": "string",
          "description": "Text for say/emote actions"
        },
        "emote_id": {
          "type": "integer",
          "description": "Emote ID to perform"
        },
        "direction": {
          "type": "integer",
          "minimum": 0,
          "maximum": 7,
          "description": "Direction to face (0-7)"
        }
      }
    }
  }
}